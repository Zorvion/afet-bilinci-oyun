<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Afet Bilinci Oyunu â€” Debug</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; text-align:center; background:#eef3f7; margin:0; padding:30px 10px; }
    .card { max-width:720px; margin:20px auto; background:white; padding:24px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.08); }
    h1 { margin:0 0 14px; color:#222; }
    #choices button { margin:8px; padding:10px 18px; font-size:16px; border-radius:8px; border:none; background:#007bff; color:#fff; cursor:pointer; }
    #choices button:hover{ background:#0056b3; }
    #log { text-align:left; max-height:160px; overflow:auto; background:#0b1220; color:#cce7ff; padding:10px; border-radius:8px; margin-top:12px; font-size:13px; }
    ul { text-align:left; padding-left:20px; max-width:640px; margin:12px auto; }
    .correct-answer { color:green; font-weight:bold; }
  </style>
</head>
<body>

  <div class="card">
    <h1 id="title">Afet Bilinci Oyunu</h1>
    <div id="choices" aria-live="polite">
      <button id="depremBtn">ğŸŒ‹ Deprem Senaryosu</button>
      <button id="yanginBtn">ğŸ”¥ YangÄ±n Senaryosu</button>
    </div>

    <div style="margin-top:14px; font-size:13px; color:#555;">
      <b>HÄ±zlÄ± Not:</b> Alttaki <i>LOG</i> penceresini izle â€” tÄ±klamalar ve hata kayÄ±tlarÄ± burada gÃ¶rÃ¼necek.
    </div>

    <div id="log" aria-hidden="false"></div>
  </div>

<script>
/* ---------- GÃ¼venli, test edilmiÅŸ yapÄ± ----------
   - script sayfanÄ±n sonunda, DOM hazÄ±r
   - tÃ¼m butonlar addEventListener ile baÄŸlandÄ±
   - gÃ¶rÃ¼nÃ¼r LOG alanÄ±: tÄ±klama/kaydetme adÄ±mlarÄ±nÄ± gÃ¶rÃ¼rsÃ¼n
   - showResult() bÃ¶lÃ¼mÃ¼nde yanlÄ±ÅŸ davranÄ±ÅŸlar listelenir
------------------------------------------------- */

(function(){
  // state
  let score = 0;
  let step = 0;
  let type = "";
  let mistakes = [];
  let maxScorePerGame = 0;

  // sahneler (uzatÄ±lmÄ±ÅŸ)
  const scenes = {
    deprem: [
      { q:"Deprem baÅŸladÄ±! Ne yaparsÄ±n?", o:["KaÃ§","Ã‡Ã¶k, Kapan, Tutun","Camdan bak"], c:2 },
      { q:"Dolap devriliyor, ne yaparsÄ±n?", o:["DolabÄ± tut","KafanÄ± koru","Pencereye koÅŸ"], c:2 },
      { q:"SarsÄ±ntÄ± azalÄ±yor, ne yaparsÄ±n?", o:["Evin iÃ§inde kal","DÄ±ÅŸarÄ± Ã§Ä±k","Elektrikleri kontrol et"], c:2 },
      { q:"DÄ±ÅŸarÄ±dasÄ±n, Ã§evre kalabalÄ±k. Ne yaparsÄ±n?", o:["Arabaya bin","AÃ§Ä±k alanda dur","Binalara yaklaÅŸ"], c:2 },
      { q:"ArtÃ§Ä± sarsÄ±ntÄ±lar baÅŸladÄ±, ne yaparsÄ±n?", o:["KoÅŸ","Yine Ã‡Ã¶k-Kapan-Tutun","Duvarda bekle"], c:2 },
      { q:"Deprem bitti, dÄ±ÅŸarÄ±dasÄ±n. Ne yaparsÄ±n?", o:["Eve hemen dÃ¶n","YaralÄ±lara yardÄ±m et","Elektrikleri aÃ§"], c:2 }
    ],
    yangin: [
      { q:"Evde yangÄ±n Ã§Ä±ktÄ±! Ne yaparsÄ±n?", o:["Su dÃ¶k (kÃ¼Ã§Ã¼kse)","Ã‡Ä±kÄ±ÅŸ yolunu bul ve kaÃ§","Pencereye bak"], c:2 },
      { q:"Duman yayÄ±lÄ±yor, ne yaparsÄ±n?", o:["KoÅŸ","EÄŸilerek ilerle","CamÄ± aÃ§"], c:2 },
      { q:"KapÄ±ya ulaÅŸtÄ±n, ne yaparsÄ±n?", o:["KapÄ±yÄ± aÃ§","KapÄ±nÄ±n sÄ±caklÄ±ÄŸÄ±nÄ± kontrol et","Geri dÃ¶n"], c:2 },
      { q:"DÄ±ÅŸarÄ± Ã§Ä±ktÄ±n! Ne yaparsÄ±n?", o:["KomÅŸuya haber ver","112/110'u ara ve toplanma yerine git","Eve geri dÃ¶n"], c:2 },
      { q:"YangÄ±n sÃ¶ndÃ¼. Ne yaparsÄ±n?", o:["Eve girme, yetkilileri bekle","Yetkililerin iznini bekle","Camdan bak"], c:1 }
    ]
  };

  // DOM
  const titleEl = document.getElementById("title");
  const choicesEl = document.getElementById("choices");
  const logEl = document.getElementById("log");
  const depremBtn = document.getElementById("depremBtn");
  const yanginBtn = document.getElementById("yanginBtn");

  // log fonksiyonu (hem gÃ¶rsel hem console)
  function log(msg){
    const time = new Date().toLocaleTimeString();
    logEl.insertAdjacentHTML('afterbegin', <div>[${time}] ${escapeHtml(msg)}</div>);
    console.log(msg);
  }
  function escapeHtml(s){ return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // event baÄŸlama (satÄ±rda; buttonlar zaten DOM'da)
  depremBtn.addEventListener('click', () => {
    log("Deprem butonuna tÄ±klandÄ±");
    start('deprem');
  });
  yanginBtn.addEventListener('click', () => {
    log("YangÄ±n butonuna tÄ±klandÄ±");
    start('yangin');
  });

  // baÅŸlat
  function start(t){
    type = t;
    score = 0;
    step = 1;
    mistakes = [];
    maxScorePerGame = scenes[type].length;
    log(Oyun baÅŸlatÄ±ldÄ±: ${type} â€” toplam sahne: ${maxScorePerGame});
    renderScene();
  }

  function renderScene(){
    const data = scenes[type];
    if(!data){ log("Hata: GeÃ§ersiz tÃ¼r: "+type); return; }
    if(step > data.length){
      log("TÃ¼m sahneler tamamlandÄ±, sonuÃ§ gÃ¶steriliyor");
      return showResult();
    }
    const scene = data[step-1];
    titleEl.textContent = Soru ${step}/${data.length}: ${scene.q};
    // temizle ve seÃ§enek oluÅŸtur
    choicesEl.innerHTML = '';
    scene.o.forEach((opt, idx) => {
      const btn = document.createElement('button');
      btn.textContent = opt;
      // kesin Ã§alÄ±ÅŸan tek tÄ±klama handler
      btn.addEventListener('click', function onClick(){
        log(SeÃ§im yapÄ±ldÄ±: sahne ${step}, seÃ§enek ${idx+1} â€” "${opt}");
        // prevent double activation by removing listener immediately
        btn.removeEventListener('click', onClick);
        handleAnswer(idx+1, scene.c, scene.q, opt);
      });
      choicesEl.appendChild(btn);
    });
  }

  function handleAnswer(choice, correct, questionText, selectedOptText){
    // kaydet
    if(choice === correct){
      score++;
      log(DoÄŸru cevap (score=${score}));
    } else {
      mistakes.push({question:questionText, selected:selectedOptText, correct: scenes[type][step-1].o[correct-1]});
      log(YanlÄ±ÅŸ cevap kaydedildi: "${selectedOptText}" â€” doÄŸru: "${scenes[type][step-1].o[correct-1]}");
    }
    // adÄ±m ilerlet
    step++;
    // kÃ¼Ã§Ã¼k gecikme ile render (UI'nin tepki vermesi daha iyi olur)
    setTimeout(()=> {
      if(step > scenes[type].length) showResult();
      else renderScene();
    }, 120);
  }

  function showResult(){
    const percentage = maxScorePerGame>0 ? Math.round((score/maxScorePerGame)*100) : 0;
    log(Oyun bitti. DoÄŸru: ${score}/${maxScorePerGame} => %${percentage});
    // oluÅŸtur
    const hatalar = mistakes.length ? mistakes.map(m => <li><b>Soru:</b> ${m.question}<br><b>Senin:</b> <span style="color:red">${m.selected}</span><br><b>DoÄŸru:</b> <span class="correct-answer">${m.correct}</span></li>).join('') : '<li>HiÃ§ hata yok â€” mÃ¼kemmelsin!</li>';
    titleEl.textContent = ${capitalize(type)} Senaryosu Bitti!;
    choicesEl.innerHTML = `
      <p style="font-size:18px;"><b>BaÅŸarÄ± PuanÄ±n:</b> <span style="color:${percentage>=80?'green':percentage>=50?'orange':'red'}">%${percentage}</span> (${score}/${maxScorePerGame})</p>
      <h3>GÃ¶zden GeÃ§irmen Gerekenler (${mistakes.length}):</h3>
      <ul>${hatalar}</ul>
      <button id="menuBtn">Ana MenÃ¼ye DÃ¶n</button>
    `;
    document.getElementById('menuBtn').addEventListener('click', () => {
      log("Ana menÃ¼ye dÃ¶nÃ¼ldÃ¼");
      // temizle logu deÄŸil ama menÃ¼ye dÃ¶n
      titleEl.textContent = 'Afet Bilinci Oyunu';
      choicesEl.innerHTML = <button id="depremBtn2">ğŸŒ‹ Deprem Senaryosu</button><button id="yanginBtn2">ğŸ”¥ YangÄ±n Senaryosu</button>;
      // yeniden baÄŸlama (yeni elementler)
      document.getElementById('depremBtn2').addEventListener('click', () => { log('Deprem butonu (yeniden) tÄ±klandÄ±'); start('deprem'); });
      document.getElementById('yanginBtn2').addEventListener('click', () => { log('YangÄ±n butonu (yeniden) tÄ±klandÄ±'); start('yangin'); });
    });
  }

  function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

  // Ek: aÃ§Ä±lÄ±ÅŸ logu
  log("Sayfa yÃ¼klendi â€” baÅŸlangÄ±Ã§ hazÄ±r. Deprem/YangÄ±n butonlarÄ±na bas.");

})(); // IIFE
</script>
</body>
</html>
