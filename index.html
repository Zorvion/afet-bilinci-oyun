<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Afet Bilinci Oyunu</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #eef3f7;
      margin: 0;
      padding: 30px 10px;
    }
    #card {
      max-width: 760px;
      margin: 20px auto;
      background: #fff;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(15,30,50,0.06);
    }
    h1 { color: #222; margin-top: 0; }
    #choices { margin-top: 14px; }
    button {
      margin: 8px;
      padding: 10px 22px;
      font-size: 15px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
    }
    button:hover { background-color: #0056b3; transform: none; }
    .muted { color: #666; font-size: 14px; margin-top: 6px; }
    #progressWrap { width: 100%; background:#e6eefc; height:12px; border-radius:8px; margin-top:12px; overflow:hidden; }
    #progressBar { height:100%; width:0%; background:linear-gradient(90deg,#4caf50,#1976d2); }
    ul { text-align:left; max-width:700px; margin:14px auto; padding-left:20px; }
    li { margin-bottom:8px; }
    .small { font-size:13px; color:#444; }
    .best { font-size:13px; color:#2e7d32; margin-left:8px; }
    @media (max-width:500px){ button{padding:10px 14px; font-size:14px;} #card{padding:14px;} }
  </style>
</head>
<body>

  <div id="card">
    <h1 id="title">Afet Bilinci Oyunu</h1>
    <div id="meta" class="muted">Tarz: tek dosya â€” aynÄ± Ã§alÄ±ÅŸan yapÄ±yÄ± koruyoruz</div>

    <div id="menu" style="margin-top:16px;">
      <p class="small">Bir senaryo seÃ§:</p>
      <div id="choices">
        <button onclick="start('deprem')">ðŸŒ‹ Deprem Senaryosu</button>
        <button onclick="start('yangin')">ðŸ”¥ YangÄ±n Senaryosu</button>
      </div>
      <div class="muted small" id="bestScores" style="margin-top:10px;"></div>
    </div>

    <div id="game" style="display:none;">
      <div id="progressWrap"><div id="progressBar"></div></div>
      <h2 id="question" style="margin-top:18px;"></h2>
      <div id="choicesArea"></div>
      <div id="hint" class="muted"></div>
    </div>

    <div id="result" style="display:none;">
      <h2 id="resultTitle"></h2>
      <div id="resultBody"></div>
      <div style="margin-top:12px;">
        <button onclick="backToMenu()">Ana MenÃ¼ye DÃ¶n</button>
        <button onclick="restart()">Tekrar Oyna</button>
      </div>
    </div>
  </div>

<script>
/* Tek dosya, saÄŸlam event baÄŸlama, 6 sahne uzatÄ±ldÄ±, hata gÃ¶sterimi, progress, best score */

let scenes = {
  deprem: [
    { q: "Deprem baÅŸladÄ±! Ne yaparsÄ±n?", o:["Pencerelere koÅŸarÄ±m","Ã‡Ã¶k-Kapan-Tutun yaparÄ±m","HiÃ§bir ÅŸey yapmam"], c:2 },
    { q: "Dolap devriliyor! Ne yaparsÄ±n?", o:["DolabÄ± tutarÄ±m","BaÅŸÄ±mÄ± korurum","Pencereye koÅŸarÄ±m"], c:2 },
    { q: "SarsÄ±ntÄ± azalÄ±yor, ne yaparsÄ±n?", o:["Evin iÃ§inde kalÄ±rÄ±m","DÄ±ÅŸarÄ± Ã§Ä±karÄ±m","Elektrikleri kontrol ederim"], c:1 },
    { q: "Binadan Ã§Ä±kÄ±yorsun, ne yaparsÄ±n?", o:["AsansÃ¶re binerim","Merdivenle kontrollÃ¼ Ã§Ä±karÄ±m","HÄ±zlÄ±ca koÅŸarÄ±m"], c:2 },
    { q: "Toplanma alanÄ±ndasÄ±n, ne yaparsÄ±n?", o:["Telefonda gezinirim","Yetkililere yardÄ±m ederim","Eve geri dÃ¶nerim"], c:2 },
    { q: "ArtÃ§Ä± sarsÄ±ntÄ± hissediyorsun, ne yaparsÄ±n?", o:["KoÅŸarÄ±m","Ã‡Ã¶k-Kapan-Tutun yaparÄ±m","Bir yere yaslanÄ±rÄ±m"], c:2 }
  ],
  yangin: [
    { q: "Evde yangÄ±n Ã§Ä±ktÄ±! Ä°lk ne yaparsÄ±n?", o:["Su dÃ¶kerim (kÃ¼Ã§Ã¼kse)","Derhal Ã§Ä±kÄ±ÅŸ yolunu bulurum","Pencereye bakarÄ±m"], c:2 },
    { q: "Duman yÃ¼kseliyor, ne yaparsÄ±n?", o:["Ayakta ilerlerim","EÄŸilerek/zemine yakÄ±n ilerlerim","KoÅŸarÄ±m"], c:2 },
    { q: "KapÄ±ya geldin, ne yaparsÄ±n?", o:["KapÄ±yÄ± aÃ§arÄ±m","KapÄ±nÄ±n sÄ±caklÄ±ÄŸÄ±nÄ± kontrol ederim","Geri dÃ¶nerim"], c:2 },
    { q: "KapÄ± sÄ±caksa ne yaparsÄ±n?", o:["Zorla aÃ§arÄ±m","BaÅŸka Ã§Ä±kÄ±ÅŸ ararÄ±m/geri dÃ¶nmem","Bekleyip yardÄ±m beklerim"], c:2 },
    { q: "DÄ±ÅŸarÄ± Ã§Ä±ktÄ±n, ne yaparsÄ±n?", o:["Eve geri girerim","112'yi ararÄ±m ve toplanma yerine giderim","YangÄ±nÄ± izlerim"], c:2 },
    { q: "YanÄ±k yaralÄ±sÄ± gÃ¶rdÃ¼n, ne yaparsÄ±n?", o:["SoÄŸuk su uygularÄ±m ve yardÄ±m Ã§aÄŸÄ±rÄ±rÄ±m","Kendi ilaÃ§larÄ±mÄ± veririm","AteÅŸi sÃ¶ndÃ¼rmeye Ã§alÄ±ÅŸÄ±rÄ±m"], c:1 }
  ]
};

let type = "";        // 'deprem' veya 'yangin'
let index = 0;        // 0-based sahne index
let score = 0;
let mistakes = [];    // {q, selected, correct}
let locked = false;   // Ã§ift basmayÄ± engelleme

function start(t){
  type = t;
  index = 0;
  score = 0;
  mistakes = [];
  locked = false;
  document.getElementById('menu').style.display = 'none';
  document.getElementById('result').style.display = 'none';
  document.getElementById('game').style.display = 'block';
  updateBestScoresDisplay();
  renderScene();
}

function renderScene(){
  const data = scenes[type];
  if(!data) return;
  if(index >= data.length) return showResult();

  const scene = data[index];
  document.getElementById('question').innerText = Soru ${index+1}/${data.length}: ${scene.q};
  const choicesArea = document.getElementById('choicesArea');
  choicesArea.innerHTML = '';
  document.getElementById('hint').innerText = '';

  // progress
  const pct = Math.round(((index) / data.length) * 100);
  document.getElementById('progressBar').style.width = pct + '%';

  scene.o.forEach((opt, i) => {
    const b = document.createElement('button');
    b.textContent = opt;
    // kesin Ã§alÄ±ÅŸan single-click handler
    b.addEventListener('click', function onClick(){
      if(locked) return;
      locked = true;
      // kÄ±sa gecikme UI iÃ§in
      setTimeout(()=> locked = false, 200);
      handleAnswer(i+1, scene.c, scene.q, opt, scene.o[scene.c-1]);
    });
    choicesArea.appendChild(b);
  });
}

function handleAnswer(choice, correct, qText, selectedText, correctText){
  if(choice === correct){
    score++;
    document.getElementById('hint').innerText = 'DoÄŸru seÃ§im âœ”';
  } else {
    mistakes.push({question:qText, selected:selectedText, correct:correctText});
    document.getElementById('hint').innerText = 'YanlÄ±ÅŸ seÃ§im âœ– (sonuÃ§ta gÃ¶sterilecek)';
  }
  index++;
  // kÃ¼Ã§Ã¼k gecikmeyle bir sonraki sahne
  setTimeout(()=> {
    if(index >= scenes[type].length) showResult();
    else renderScene();
  }, 250);
}

function showResult(){
  const total = scenes[type].length;
  const pct = Math.round((score/total)*100);
  const level = pct >= 80 ? 'Uzman' : pct >= 50 ? 'Orta' : 'Acemi';
  // kaydet best score
  saveBestScore(type, pct);

  const best = getBestScore(type);

  document.getElementById('resultTitle').innerText = ${capitalize(type)} Senaryosu Bitti! â€” ${level};
  const mistakesHtml = mistakes.length ? mistakes.map(m => <li><b>Soru:</b> ${m.question}<br><b>Senin:</b> <span style="color:red">${m.selected}</span><br><b>DoÄŸru:</b> <span style="color:green">${m.correct}</span></li>).join('') : '<li>HiÃ§ hata yok â€” mÃ¼kemmelsin!</li>';
  document.getElementById('resultBody').innerHTML = `
    <p class="small"><b>Puan:</b> %${pct} (${score}/${total}) <span class="best">| En iyi: %${best}</span></p>
    <h3>YanlÄ±ÅŸ DavranÄ±ÅŸlar (${mistakes.length}):</h3>
    <ul>${mistakesHtml}</ul>
  `;
  // progress dolu
  document.getElementById('progressBar').style.width = '100%';
  // gÃ¶rÃ¼nÃ¼rlÃ¼k
  document.getElementById('game').style.display = 'none';
  document.getElementById('result').style.display = 'block';
}

function backToMenu(){
  document.getElementById('result').style.display = 'none';
  document.getElementById('game').style.display = 'none';
  document.getElementById('menu').style.display = 'block';
  document.getElementById('title').innerText = 'Afet Bilinci Oyunu';
  updateBestScoresDisplay();
}

function restart(){
  start(type);
}

function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

/* localStorage best score */
function saveBestScore(t, pct){
  try {
    const key = 'best_'+t;
    const prev = parseInt(localStorage.getItem(key) || '0', 10);
    if(pct > prev) localStorage.setItem(key, String(pct));
  } catch(e){}
}
function getBestScore(t){
  try { return parseInt(localStorage.getItem('best_'+t) || '0', 10); } catch(e){ return 0; }
}
function updateBestScoresDisplay(){
  const d = getBestScore('deprem') || 0;
  const y = getBestScore('yangin') || 0;
  document.getElementById('bestScores').innerHTML = En iyi skorlar â€” Deprem: <span class="best">%${d}</span> | YangÄ±n: <span class="best">%${y}</span>;
}

// sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda bestleri gÃ¶ster
updateBestScoresDisplay();
</script>

</body>
</html>
